<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>单个编辑</title>
<link rel="stylesheet" type="text/css" href="css/common.css"/>
<link rel="stylesheet" type="text/css" href="css/login.css">
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
</head>
<body>
	<div id="banner"></div>
	<div id="top-nav">
		<div class="Rw">
			<img src="img/logo.png"/>
			<ul class="top-nav__list Fr">
				<li><a href="#">公司简介</a></li>
				<li><a href="#">新闻发布</a></li>
				<li><a href="#">消控地图</a></li>
				<li><a href="http://192.168.10.10">监控平台</a></li>
				<li><a href="#">三轮车管理</a></li>
				<li><a href="#" class="act">员工登陆</a></li>
			</ul>
		</div>
	</div>

	<div class="Rw">
		<section id="sbedit-box">
			<div class="box">
				<h1 class='form-title'>编辑设备</h1>
				<!--设备id-->
				<input type='hidden' id='sbid'/>
				<ul class="sbedit-form">
					<li class="form-row">
						<label class="form-label">设备名称</label>
						<span id='sbname'>lalalallalala</span>
					</li>
					<li class="form-row">
						<label class="form-label">设备所在区域</label>
						<span id='sbregion'>lalalallalala</span>
					</li>
					<li class="form-row">
						<label class="form-label">有效期</label>
						<input type='text' id='validtime' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">负责人员</label>
						<input type='text' id='duty' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">检查人员</label>
						<input type='text' id='checkname' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">最后巡检时间</label>
						<input type='text' id='lasttime' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">最后巡检人</label>
						<input type='text' id='lastcheckname' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">设备维保期</label>
						<input type='text' id='servicetime' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">维保厂家</label>
						<input type='text' id='sbvender' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">维保联系人</label>
						<input type='text' id='servicename' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">备注</label>
						<input type='text' id='remarks' class="form-control form-control-half"/>
					</li>
				</ul>
				<button class='form-btn' onclick='doedit();'>确认修改</button>
			</div>
		</section>
	</div>
</body>
<script>

$(document).ready(function() { 
	var v = parseUrl();//解析所有参数
	$('#sbid').val(v['sbid']);
	getinfo(v['sbid']);
	//alert(v['sbid']);//就是你要的结果
});


function getinfo(sbid){
	$.ajax({
	    type: "post",
	    url: "http://huhuajian.pe.hu/public/index.php/index/reports/getsbinfobyid",
	    dataType: "jsonp",
	    jsonp: "callback",
	    jsonpCallback: "h",
	    data:{sbid:sbid},
	    success: function(data) {
	    	$('#sbname').html(data.data.name);
	    	$('#sbregion').html(data.data.region);
	    	$('#validtime').val(data.data.validTime);
	    	$('#duty').val(data.data.duty);
	    	$('#checkname').val(data.data.check_name);
	    	$('#lasttime').val(data.data.lastTime);
	    	$('#servicetime').val(data.data.servicetime);
	    	$('#sbvender').val(data.data.servicevender);
	    	$('#servicename').val(data.data.servicename);
	    	$('#lastcheckname').val(data.data.last_check_name);
	    	$('#remarks').val(data.data.remarks);
	        //console.log(data);
	    },
	    error: function() {
	        alert('fail');
	    }
	});	
}


function doedit(){
	
	var shebeiid = $('#sbid').val();
	var validtime = $('#validtime').val();
	var duty = $('#duty').val();
	var checkname = $('#checkname').val();
	var lasttime = $('#lasttime').val();
	var servicetime = $('#servicetime').val();
	var sbvender = $('#sbvender').val();
	var servicename = $('#servicename').val();
	var lastcheckname = $('#lastcheckname').val();
	var remarks = $('#remarks').val();
	
	$.ajax({
	    type: "post",
	    url: "http://huhuajian.pe.hu/public/index.php/index/index/edit_material",
	    dataType: "jsonp",
	    jsonp: "callback",
	    jsonpCallback: "h",
	    data:{shebeiid:shebeiid,validTime:validtime,duty:duty,check_name:checkname,lastTime:lasttime,
	    	servicetime:servicetime,servicevender:sbvender,servicename:servicename,
	    	last_check_name:lastcheckname,remarks:remarks
	    },
	    success: function(data) {
	    	alert(data.message);
	    	if(data.code == 1){
	    		getinfo(data.data.id);
	    	}
	        console.log(data);
	    },
	    error: function() {
	        alert('服务器繁忙，请稍后再试。');
	    }
	});
}


function parseUrl(){
    var url=location.href;
    var i=url.indexOf('?');
    if(i==-1)return;
    var querystr=url.substr(i+1);
    var arr1=querystr.split('&');
    var arr2=new Object();
    for  (i in arr1){
        var ta=arr1[i].split('=');
        arr2[ta[0]]=ta[1];
    }
    return arr2;
}
</script>

</html>