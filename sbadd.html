<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>添加设备</title>
<link rel="stylesheet" type="text/css" href="css/common.css"/>
<link rel="stylesheet" type="text/css" href="css/login.css">
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
</head>
<body>
	<div id="banner"></div>
	<div id="top-nav">
		<div class="Rw">
			<img src="img/logo.png"/>
			<ul class="top-nav__list Fr">
				<li><a href="outer-map.html">返回首页</a></li>
				<li><a href="sblist.html">设备列表</a></li>
				<li><a href="editgly.html">编辑管理员</a></li>
				<li><a href="#" class="act">编辑设备</a></li>
				<li><a href="login.html">员工登陆</a></li>
				<li><a onclick="dologout();">退出登录</a></li>
			</ul>
		</div>
	</div>

	<div class="Rw">
		<section id="sbedit-box">
			<div class="box">
				<h1 class='form-title'>添加设备</h1>
				<ul class="sbedit-form">
					<li class="form-row">
						<label class="form-label">设备所在区域</label>
						<select class="selectpicker" id='select_zones' onchange="gradeChange()">
							<option value='-1'>外部设备</option>
						</select>
						<!-- <span id='sbregion'>lalalallalala</span> -->
					</li>
					<li class="form-row">
						<label class="form-label">设备类型</label>
							<select class="selectpicker" id='sbtype'>
								<option value='1'>手推式灭火器</option>
								<option value='2'>手提式灭火器</option>
								<option value='3'>消防栓</option>
								<option value='4'>报警按钮</option>
								<option value='5'>进水栓</option>
							</select>
					</li>
					地图url，调试完后设隐藏<input type='text' id='mapurl'/>
					
					<li class="form-row">
						<label class="form-label">有效期</label>
						<input type='text' id='validtime' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">负责人员</label>
						<input type='text' id='duty' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">检查人员</label>
						<input type='text' id='checkname' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">最后巡检时间</label>
						<input type='text' id='lasttime' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">最后巡检人</label>
						<input type='text' id='lastcheckname' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">设备维保期</label>
						<input type='text' id='servicetime' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">维保厂家</label>
						<input type='text' id='sbvender' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">维保联系人</label>
						<input type='text' id='servicename' class="form-control form-control-half"/>
						<i class="form-must-icon">*</i>
					</li>
					<li class="form-row">
						<label class="form-label">备注</label>
						<input type='text' id='remarks' class="form-control form-control-half"/>
					</li>
					<input type='hidden' id='xposition' /><!-- x坐标放这儿 -->
					<input type='hidden' id='yposition' /><!-- y坐标放这儿 -->
					<li class="form-row">
						<button>选择设备位置</button>
					</li>
				</ul>
				<button class='form-btn' onclick='doadd();'>添加</button>
			</div>
		</section>
	</div>
</body>
<script>

$(document).ready(function() { 
	$.ajax({
	    type: "post",
	    url: "http://huhuajian.pe.hu/public/index.php/index/index/get_son_list",
	    dataType: "jsonp",
	    jsonp: "callback",
	    jsonpCallback: "h",
	    success: function(data) {
	        for (var i = 0; i < data.data.length; i++) {
	            document.getElementById("select_zones").options.add(new Option(data.data[i].name,data.data[i].floorid));
	        }
	        //console.log(data);
	    },
	    error: function() {
	        alert('fail');
	    }
	});	
	var grade = '-1';
	$.ajax({
 	    type: "post",
 	    url: "http://huhuajian.pe.hu/public/index.php/index/index/get_mapurl",
 	    dataType: "jsonp",
 	    jsonp: "callback",
 	    data:{floorid:grade},
 	    jsonpCallback: "gurl",
 	    success: function(data) {
 	    	if(data.code == 1){
 	    		$('#mapurl').val(data.data.parameter);
 	    	}else{
 	    		alert(data.message);
 	    		return ;
 	    	}
 	    },
 	    error: function() {
 	        alert('fail');
 	    }
 	});
	
});

function gradeChange(){
	 var objS = document.getElementById("select_zones");
     var grade = objS.options[objS.selectedIndex].value;
     $.ajax({
 	    type: "post",
 	    url: "http://huhuajian.pe.hu/public/index.php/index/index/get_mapurl",
 	    dataType: "jsonp",
 	    jsonp: "callback",
 	    data:{floorid:grade},
 	    jsonpCallback: "gurl",
 	    success: function(data) {
 	    	if(data.code == 1){
 	    		$('#mapurl').val(data.data.parameter);
 	    	}else{
 	    		alert(data.message);
 	    		return ;
 	    	}
 	    	
 	        console.log(data);
 	    },
 	    error: function() {
 	        alert('fail');
 	    }
 	});
     //alert(grade);
}

function doadd(){
	var reid = $('#select_zones').val();
	var sbtype = $('#sbtype').val();
	var validtime = $('#validtime').val();
	var duty = $('#duty').val();
	var checkname = $('#checkname').val();
	var lasttime = $('#lasttime').val();
	var servicetime = $('#servicetime').val();
	var sbvender = $('#sbvender').val();
	var servicename = $('#servicename').val();
	var lastcheckname = $('#lastcheckname').val();
	var remarks = $('#remarks').val();
	var xposition = $('#xposition').val();
	var yposition = $('#yposition').val();
	
	$.ajax({
	    type: "post",
	    url: "http://huhuajian.pe.hu/public/index.php/index/index/add_material",
	    dataType: "jsonp",
	    jsonp: "callback",
	    jsonpCallback: "doad",
	    data:{reid:reid,validTime:validtime,duty:duty,check_name:checkname,lastTime:lasttime,
	    	servicetime:servicetime,servicevender:sbvender,servicename:servicename,
	    	last_check_name:lastcheckname,remarks:remarks,xposition:xposition,yposition:yposition,
	    	sbtype:sbtype
	    },
	    success: function(data) {
	    	alert(data.message);
	    	if(data.code == 1){
	    		getinfo(data.data.id);
	    	}
	    	location.reload(); 
	        console.log(data);
	    },
	    error: function() {
	        alert('服务器繁忙，请稍后再试。');
	    }
	});
}


function dologout(){
	$.ajax({
	    type : "post",
	    url : "http://huhuajian.pe.hu/public/index.php/index/login/logout",
	    dataType : "jsonp",
	    jsonp: "callback",
	    jsonpCallback:"logout",
	    success : function(data){
	        alert(data.message);
	    },
	    error:function(){
	    	alert('服务器繁忙，请稍后再试。');
	    }
	});
}
</script>

</html>